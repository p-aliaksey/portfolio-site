<!DOCTYPE html>
<html lang="{{ translations.get_language() }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t.architecture.title }} - DevOps Portfolio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        .architecture-diagram {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .component-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .component-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #007bff;
        }
        .component-card h3 {
            margin-top: 0;
            color: #007bff;
        }
        .port-info {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .flow-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .flow-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #28a745;
        }
        .flow-arrow {
            margin: 0 10px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a class="brand" href="/">DevOps Portfolio</a>
            <div class="links">
                <a href="/about">{{ t.nav.about }}</a>
                <a href="/monitoring">{{ t.nav.monitoring }}</a>
                <a href="/architecture">{{ t.nav.architecture }}</a>
                <div class="language-switcher">
                    <a href="/set_language/ru" class="lang-btn {{ 'active' if translations.get_language() == 'ru' else '' }}">RU</a>
                    <a href="/set_language/en" class="lang-btn {{ 'active' if translations.get_language() == 'en' else '' }}">EN</a>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="container" style="padding: 48px 24px">
            <h1>{{ t.architecture.title }}</h1>
            <p class="lead">{{ t.architecture.subtitle }}</p>

        <div class="architecture-diagram">
            <h2>üèóÔ∏è Diagram</h2>
            <div class="mermaid">
graph LR
    %% User
    U[üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å<br/>–ë—Ä–∞—É–∑–µ—Ä]
    
    %% GitHub & CI/CD
    subgraph "üêô GitHub & CI/CD"
        GH[GitHub<br/>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥]
        GHA[GitHub Actions<br/>CI/CD Pipeline]
    end
    
    %% Terraform
    subgraph "üèóÔ∏è Infrastructure"
        TF[Terraform<br/>IaC]
    end
    
    %% Yandex Cloud
    subgraph "‚òÅÔ∏è Yandex Cloud"
        VM[VM<br/>Ubuntu 24.04 LTS<br/>2 CPU, 2GB RAM]
    end
    
    %% Ansible
    subgraph "üîß Configuration"
        ANS[Ansible<br/>Playbooks]
    end
    
    %% Docker Containers
    subgraph "üê≥ Docker Containers"
        N[üåê Nginx<br/>Port 80/443]
        A[üöÄ Flask App<br/>Port 8000]
        P[üìä Prometheus<br/>Port 9090]
        G[üìà Grafana<br/>Port 3001]
        L[üìù Loki<br/>Port 3100]
        PT[üìã Promtail]
    end
    
    %% External Services
    GHCR[üì¶ GitHub Container Registry]
    DATA[üíæ Data Storage]
    
    %% Main Flow
    U -->|HTTPS| N
    N -->|Routes| A
    
    GH -->|Push| GHA
    GHA -->|Build| GHCR
    GHA -->|Deploy| TF
    TF -->|Create| VM
    GHA -->|Configure| ANS
    ANS -->|Setup| VM
    
    GHCR -->|Pull| VM
    VM -->|Runs| N
    VM -->|Runs| A
    VM -->|Runs| P
    VM -->|Runs| G
    VM -->|Runs| L
    VM -->|Runs| PT
    
    %% Monitoring & Logging
    P -->|Scrapes| A
    G -->|Queries| P
    PT -->|Logs| L
    G -->|Logs| L
    
    %% Data Storage
    A -->|Stores| DATA
    G -->|Stores| DATA
    L -->|Stores| DATA
    
    %% Styling
    classDef userClass fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef githubClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef terraformClass fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,color:#000
    classDef cloudClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef ansibleClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
    classDef containerClass fill:#f1f8e9,stroke:#689f38,stroke-width:2px,color:#000
    classDef serviceClass fill:#e0f2f1,stroke:#00695c,stroke-width:2px,color:#000
    
    class U userClass
    class GH,GHA githubClass
    class TF terraformClass
    class VM cloudClass
    class ANS ansibleClass
    class N,A containerClass
    class P,G,L,PT serviceClass
    class GHCR,DATA serviceClass
            </div>
        </div>

        <div class="component-info">
            <div class="component-card">
                <h3>üêô GitHub & CI/CD</h3>
                <p><strong>GitHub Repository</strong> - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞</p>
                <p><strong>GitHub Actions</strong> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π CI/CD –ø–∞–π–ø–ª–∞–π–Ω</p>
                <p><strong>GitHub Container Registry</strong> - –•—Ä–∞–Ω–µ–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤</p>
                <div class="port-info">üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ main</div>
            </div>

            <div class="component-card">
                <h3>‚òÅÔ∏è Yandex Cloud VM</h3>
                <p><strong>Ubuntu 24.04 LTS</strong> - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</p>
                <p><strong>2 CPU, 2GB RAM</strong> - –†–µ—Å—É—Ä—Å—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã</p>
                <p><strong>Terraform</strong> - –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞–∫ –∫–æ–¥</p>
                <div class="port-info">üîí Security Groups –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 22,80,443,9090,3001,3100</div>
            </div>

            <div class="component-card">
                <h3>üê≥ Docker –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã</h3>
                <p><strong>üåê Nginx</strong> - Reverse proxy, SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—è (Port 80/443)</p>
                <p><strong>üöÄ Flask App</strong> - –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ (Port 8000)</p>
                <p><strong>üìä Prometheus</strong> - –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (Port 9090)</p>
                <p><strong>üìà Grafana</strong> - –î–∞—à–±–æ—Ä–¥—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (Port 3001)</p>
                <p><strong>üìù Loki</strong> - –•—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ (Port 3100)</p>
                <p><strong>üìã Promtail</strong> - –°–±–æ—Ä –ª–æ–≥–æ–≤ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</p>
            </div>

            <div class="component-card">
                <h3>üîß Ansible Playbooks</h3>
                <p><strong>Configuration Management</strong> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VM</p>
                <p><strong>Docker Compose</strong> - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</p>
                <p><strong>Deployment</strong> - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
                <div class="port-info">‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ</div>
            </div>

            <div class="component-card">
                <h3>üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
                <p><strong>SQLite Database</strong> - –î–∞–Ω–Ω—ã–µ Grafana (–¥–∞—à–±–æ—Ä–¥—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)</p>
                <p><strong>File System</strong> - –õ–æ–≥–∏ Loki</p>
                <p><strong>Backup System</strong> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã</p>
                <div class="port-info">üíæ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ VM</div>
            </div>
        </div>

        <div class="flow-section">
            <h2>üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
            
            <div class="flow-item">
                <h3>üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π</h3>
                <p><strong>1. Push –≤ GitHub</strong> ‚Üí GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è</p>
                <p><strong>2. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞</strong> ‚Üí Docker –æ–±—Ä–∞–∑ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ GHCR</p>
                <p><strong>3. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã</strong> ‚Üí Terraform –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Yandex Cloud</p>
                <p><strong>4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VM</strong> ‚Üí Ansible –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–µ—Ä</p>
                <p><strong>5. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</strong> ‚Üí Docker Compose —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã</p>
            </div>

            <div class="flow-item">
                <h3>üåê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫</h3>
                <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</strong> ‚Üí <strong>Nginx</strong> (HTTPS) ‚Üí <strong>Flask App</strong></p>
                <p><strong>–ú–∞—Ä—à—Ä—É—Ç—ã:</strong></p>
                <ul>
                    <li><code>/</code> ‚Üí –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</li>
                    <li><code>/monitoring</code> ‚Üí –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</li>
                    <li><code>/architecture</code> ‚Üí –≠—Ç–∞ —Å—Ö–µ–º–∞</li>
                    <li><code>/prometheus/</code> ‚Üí –ú–µ—Ç—Ä–∏–∫–∏</li>
                    <li><code>/grafana/</code> ‚Üí –î–∞—à–±–æ—Ä–¥—ã</li>
                    <li><code>/loki/</code> ‚Üí –õ–æ–≥–∏</li>
                </ul>
            </div>

            <div class="flow-item">
                <h3>üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
                <p><strong>Prometheus</strong> —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</p>
                <p><strong>Grafana</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã</p>
                <p><strong>Promtail</strong> —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ <strong>Loki</strong></p>
                <p><strong>Grafana</strong> –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏ –º–µ—Ç—Ä–∏–∫–∏, –∏ –ª–æ–≥–∏</p>
            </div>

            <div class="flow-item">
                <h3>üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ</h3>
                <p><strong>SQLite</strong> - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Grafana –∏ –¥–∞—à–±–æ—Ä–¥—ã</p>
                <p><strong>–§–∞–π–ª—ã</strong> - –ª–æ–≥–∏ Loki</p>
                <p><strong>–ê–≤—Ç–æ–±—ç–∫–∞–ø—ã</strong> - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00</p>
            </div>
        </div>

        <div class="flow-section">
            <h2>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
            <div class="flow-item">
                <strong>üîí Firewall:</strong> Yandex Cloud Security Groups (–ø–æ—Ä—Ç—ã 22,80,443,9090,3001,3100)
            </div>
            <div class="flow-item">
                <strong>üîê HTTPS:</strong> Let's Encrypt SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
            </div>
            <div class="flow-item">
                <strong>üê≥ –ò–∑–æ–ª—è—Ü–∏—è:</strong> Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ—Ç–∏
            </div>
            <div class="flow-item">
                <strong>üîë SSH:</strong> –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º
            </div>
        </div>
        </section>
    </main>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>

    <footer>
        <p>¬© 2025 DevOps Portfolio</p>
    </footer>
</body>
</html>
