<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - DevOps Portfolio</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        .architecture-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .architecture-diagram {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .component-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .component-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #007bff;
        }
        .component-card h3 {
            margin-top: 0;
            color: #007bff;
        }
        .port-info {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .flow-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .flow-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #28a745;
        }
        .flow-arrow {
            margin: 0 10px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="{{ url_for('index') }}" class="nav-logo">DevOps Portfolio</a>
            <div class="nav-menu">
                <a href="{{ url_for('index') }}" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="{{ url_for('about') }}" class="nav-link">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
                <a href="{{ url_for('monitoring') }}" class="nav-link">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</a>
                <a href="{{ url_for('architecture') }}" class="nav-link active">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</a>
                <a href="{{ url_for('metrics') }}" class="nav-link">–ú–µ—Ç—Ä–∏–∫–∏</a>
            </div>
        </div>
    </nav>

    <div class="architecture-container">
        <h1>üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</h1>
        <p>–°—Ö–µ–º–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ DevOps Portfolio</p>

        <div class="architecture-diagram">
            <h2>–î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</h2>
            <div class="mermaid">
graph TB
    subgraph "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
        U[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å<br/>–ë—Ä–∞—É–∑–µ—Ä]
    end
    
    subgraph "üêô GitHub"
        GH[GitHub Repository<br/>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥]
        GHA[GitHub Actions<br/>CI/CD Pipeline]
    end
    
    subgraph "‚òÅÔ∏è Yandex Cloud"
        subgraph "üèóÔ∏è Infrastructure (Terraform)"
            VPC[VPC Network<br/>10.10.0.0/24]
            SG[Security Groups<br/>Ports: 22,80,443,9090,3001,3100]
            VM[VM Instance<br/>Ubuntu 24.04 LTS<br/>2 CPU, 2GB RAM]
        end
        
        subgraph "üê≥ Docker Environment"
            subgraph "üåê Web Layer"
                N[üåê Nginx<br/>Port 80/443<br/>Reverse Proxy<br/>SSL Termination]
            end
            
            subgraph "üöÄ Application Layer"
                A[üöÄ Flask App<br/>Port 8000<br/>Portfolio Site<br/>i18n Support]
            end
            
            subgraph "üìä Monitoring Layer"
                P[üìä Prometheus<br/>Port 9090<br/>Metrics Collection<br/>Service Discovery]
                G[üìà Grafana<br/>Port 3001<br/>Dashboards<br/>Visualization]
            end
            
            subgraph "üìù Logging Layer"
                L[üìù Loki<br/>Port 3100<br/>Log Aggregation<br/>Storage]
                PT[üìã Promtail<br/>Log Collection<br/>Docker Logs]
            end
            
            subgraph "üíæ Data Layer"
                GD[(üíæ Grafana Data<br/>SQLite Database<br/>Dashboards & Settings)]
                LD[(üíæ Loki Data<br/>File System<br/>Log Storage)]
                BD[(üíæ Backup Data<br/>/opt/backups<br/>Automated Backups)]
            end
        end
    end
    
    subgraph "üì¶ Container Registry"
        GHCR[GitHub Container Registry<br/>Docker Images<br/>ghcr.io/owner/repo]
    end
    
    subgraph "üîß Configuration Management"
        ANS[Ansible Playbooks<br/>Configuration<br/>Deployment]
    end
    
    %% User connections
    U -->|HTTP/HTTPS| N
    
    %% GitHub Actions CI/CD Flow
    GH -->|Push to main| GHA
    GHA -->|1. Build Image| GHCR
    GHA -->|2. Deploy Infrastructure| VPC
    GHA -->|3. Run Ansible| ANS
    
    %% Infrastructure dependencies
    VPC --> SG
    SG --> VM
    VM --> N
    
    %% Nginx routing
    N -->|/| A
    N -->|/prometheus/| P
    N -->|/grafana/| G
    N -->|/loki/| L
    N -->|/monitoring/| A
    N -->|/architecture/| A
    
    %% Application dependencies
    A -->|Depends on| N
    A -->|Exposes metrics| P
    
    %% Monitoring connections
    P -->|Scrape metrics| A
    P -->|Scrape metrics| N
    P -->|Scrape metrics| P
    P -->|Scrape metrics| G
    P -->|Scrape metrics| L
    P -->|Scrape metrics| PT
    G -->|Query metrics| P
    G -->|Query logs| L
    
    %% Logging connections
    PT -->|Collect logs| A
    PT -->|Collect logs| N
    PT -->|Collect logs| P
    PT -->|Collect logs| G
    PT -->|Collect logs| L
    PT -->|Send logs| L
    
    %% Data storage
    G -->|Store data| GD
    L -->|Store logs| LD
    A -->|Backup data| BD
    
    %% Container registry
    GHCR -->|Pull image| A
    GHCR -->|Pull image| N
    GHCR -->|Pull image| P
    GHCR -->|Pull image| G
    GHCR -->|Pull image| L
    GHCR -->|Pull image| PT
    
    %% Configuration management
    ANS -->|Configure| VM
    ANS -->|Deploy| A
    ANS -->|Setup| P
    ANS -->|Setup| G
    ANS -->|Setup| L
    ANS -->|Setup| PT
    ANS -->|Setup| BD
    
    %% Styling
    classDef userClass fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef githubClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef infraClass fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef webClass fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef appClass fill:#e3f2fd,stroke:#0277bd,stroke-width:2px
    classDef monitorClass fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef logClass fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef storageClass fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    classDef registryClass fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef configClass fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    
    class U userClass
    class GH,GHA githubClass
    class VPC,SG,VM infraClass
    class N webClass
    class A appClass
    class P,G monitorClass
    class L,PT logClass
    class GD,LD,BD storageClass
    class GHCR registryClass
    class ANS configClass
            </div>
        </div>

        <div class="component-info">
            <div class="component-card">
                <h3>üêô GitHub & CI/CD</h3>
                <p><strong>GitHub Repository</strong> - –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞</p>
                <p><strong>GitHub Actions</strong> - CI/CD –ø–∞–π–ø–ª–∞–π–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º</p>
                <p><strong>GitHub Container Registry</strong> - –•—Ä–∞–Ω–µ–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤</p>
                <div class="port-info">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ main</div>
            </div>

            <div class="component-card">
                <h3>‚òÅÔ∏è Yandex Cloud Infrastructure</h3>
                <p><strong>Terraform</strong> - –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞–∫ –∫–æ–¥</p>
                <p><strong>VPC Network</strong> - –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å–µ—Ç—å 10.10.0.0/24</p>
                <p><strong>Security Groups</strong> - Firewall –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–æ–≤</p>
                <p><strong>VM Instance</strong> - Ubuntu 24.04 LTS, 2 CPU, 2GB RAM</p>
            </div>

            <div class="component-card">
                <h3>üåê Web Layer</h3>
                <p><strong>Nginx</strong> - Reverse proxy —Å SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–µ–π</p>
                <div class="port-info">Port 80 (HTTP), 443 (HTTPS)</div>
                <p>–§—É–Ω–∫—Ü–∏–∏: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, SSL, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã</p>
            </div>

            <div class="component-card">
                <h3>üöÄ Application Layer</h3>
                <p><strong>Flask App</strong> - –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</p>
                <div class="port-info">Port 8000</div>
                <p>–§—É–Ω–∫—Ü–∏–∏: –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, API, –º–µ—Ç—Ä–∏–∫–∏, i18n –ø–æ–¥–¥–µ—Ä–∂–∫–∞</p>
            </div>

            <div class="component-card">
                <h3>üìä Monitoring Layer</h3>
                <p><strong>Prometheus</strong> - –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å service discovery</p>
                <div class="port-info">Port 9090</div>
                <p><strong>Grafana</strong> - –î–∞—à–±–æ—Ä–¥—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</p>
                <div class="port-info">Port 3001</div>
                <p>–§—É–Ω–∫—Ü–∏–∏: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, –∞–ª–µ—Ä—Ç—ã</p>
            </div>

            <div class="component-card">
                <h3>üìù Logging Layer</h3>
                <p><strong>Loki</strong> - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤</p>
                <div class="port-info">Port 3100</div>
                <p><strong>Promtail</strong> - –°–±–æ—Ä –ª–æ–≥–æ–≤ —Å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</p>
                <p>–§—É–Ω–∫—Ü–∏–∏: –ê–≥—Ä–µ–≥–∞—Ü–∏—è, –ø–æ–∏—Å–∫, –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤</p>
            </div>

            <div class="component-card">
                <h3>üíæ Data Layer</h3>
                <p><strong>Grafana Data</strong> - SQLite –±–∞–∑–∞ —Å –¥–∞—à–±–æ—Ä–¥–∞–º–∏</p>
                <p><strong>Loki Data</strong> - –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –ª–æ–≥–æ–≤</p>
                <p><strong>Backup Data</strong> - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –≤ /opt/backups</p>
            </div>

            <div class="component-card">
                <h3>üîß Configuration Management</h3>
                <p><strong>Ansible Playbooks</strong> - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π</p>
                <p><strong>Docker Compose</strong> - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</p>
                <p>–§—É–Ω–∫—Ü–∏–∏: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</p>
            </div>
        </div>

        <div class="flow-section">
            <h2>üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</h2>
            
            <div class="flow-item">
                <h3>üöÄ CI/CD Pipeline</h3>
                <p><strong>1. Push –≤ main branch</strong> ‚Üí GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è</p>
                <p><strong>2. Build Stage</strong> ‚Üí –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
                <p><strong>3. Push to Registry</strong> ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞ –≤ GHCR</p>
                <p><strong>4. Infrastructure</strong> ‚Üí Terraform —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ Yandex Cloud</p>
                <p><strong>5. Configuration</strong> ‚Üí Ansible –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç VM –∏ –¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</p>
                <p><strong>6. Deployment</strong> ‚Üí Docker Compose –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã</p>
            </div>

            <div class="flow-item">
                <h3>üåê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç—Ä–∞—Ñ–∏–∫</h3>
                <p><strong>HTTP/HTTPS</strong> ‚Üí Nginx (Port 80/443)</p>
                <p><strong>–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:</strong></p>
                <ul>
                    <li><code>/</code> ‚Üí Flask App (Port 8000) - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç</li>
                    <li><code>/monitoring</code> ‚Üí Flask App - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</li>
                    <li><code>/architecture</code> ‚Üí Flask App - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞</li>
                    <li><code>/prometheus/</code> ‚Üí Prometheus (Port 9090) - –ú–µ—Ç—Ä–∏–∫–∏</li>
                    <li><code>/grafana/</code> ‚Üí Grafana (Port 3001) - –î–∞—à–±–æ—Ä–¥—ã</li>
                    <li><code>/loki/</code> ‚Üí Loki (Port 3100) - –õ–æ–≥–∏</li>
                </ul>
            </div>

            <div class="flow-item">
                <h3>üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏</h3>
                <p><strong>–°–±–æ—Ä –º–µ—Ç—Ä–∏–∫:</strong> Prometheus ‚Üí –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã (Flask, Nginx, Prometheus, Grafana, Loki, Promtail)</p>
                <p><strong>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:</strong> Grafana ‚Üí Prometheus (–∑–∞–ø—Ä–æ—Å –º–µ—Ç—Ä–∏–∫)</p>
                <p><strong>Service Discovery:</strong> Prometheus –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã</p>
                <p><strong>–ê–ª–µ—Ä—Ç—ã:</strong> Prometheus ‚Üí Alertmanager ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
            </div>

            <div class="flow-item">
                <h3>üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                <p><strong>–°–±–æ—Ä –ª–æ–≥–æ–≤:</strong> Promtail ‚Üí Docker Socket ‚Üí –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã</p>
                <p><strong>–ê–≥—Ä–µ–≥–∞—Ü–∏—è:</strong> Promtail ‚Üí Loki (Port 3100)</p>
                <p><strong>–•—Ä–∞–Ω–µ–Ω–∏–µ:</strong> Loki ‚Üí –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (/var/lib/loki)</p>
                <p><strong>–ü–æ–∏—Å–∫:</strong> Grafana ‚Üí Loki (–∑–∞–ø—Ä–æ—Å –ª–æ–≥–æ–≤)</p>
            </div>

            <div class="flow-item">
                <h3>üíæ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
                <p><strong>Grafana Data:</strong> SQLite –±–∞–∑–∞ ‚Üí /var/lib/grafana</p>
                <p><strong>Loki Data:</strong> –§–∞–π–ª—ã –ª–æ–≥–æ–≤ ‚Üí /var/lib/loki</p>
                <p><strong>Backup Data:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã ‚Üí /opt/backups</p>
                <p><strong>Application Data:</strong> –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã ‚Üí /app/static</p>
            </div>

            <div class="flow-item">
                <h3>üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <p><strong>Infrastructure as Code:</strong> Terraform ‚Üí Yandex Cloud API</p>
                <p><strong>Configuration Management:</strong> Ansible ‚Üí VM –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</p>
                <p><strong>Container Orchestration:</strong> Docker Compose ‚Üí –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤</p>
                <p><strong>Secrets Management:</strong> GitHub Secrets ‚Üí CI/CD –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</p>
            </div>
        </div>

        <div class="flow-section">
            <h2>üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
            <div class="flow-item">
                <strong>Firewall:</strong> –ù–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ Yandex Cloud Security Groups
            </div>
            <div class="flow-item">
                <strong>HTTPS:</strong> Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
            </div>
            <div class="flow-item">
                <strong>–ò–∑–æ–ª—è—Ü–∏—è:</strong> Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ—Ç–∏
            </div>
            <div class="flow-item">
                <strong>–î–æ—Å—Ç—É–ø:</strong> SSH –∫–ª—é—á–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>
